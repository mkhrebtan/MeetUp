<div class="p-8 max-w-4xl mx-auto">
  <div class="mb-8">
    <p-button
      (click)="goBack()"
      icon="pi pi-arrow-left"
      label="Back"
      severity="secondary"
      size="small"
      text
    ></p-button>
    <div class="px-2">
      <h1 class="text-3xl font-bold text-foreground">My Profile</h1>
      <p class="text-muted-foreground mt-1">Manage your personal account settings</p>
    </div>
  </div>

  <div class="space-y-6">
    <p-card>
      <div class="py-6 pt-1 space-y-1">
        <h3 class="font-semibold text-lg">Personal Information</h3>
        <p class="text-muted-foreground text-sm">Update your profile details and public info</p>
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="onSubmit()">
        <div class="space-y-6">
        <div class="flex items-center gap-6">
          <div class="w-24 h-24 rounded-full bg-muted flex items-center justify-center overflow-hidden">
            @if (avatarPreview()) {
              <img [ngSrc]="avatarPreview()!" alt="Avatar preview" class="w-full h-full object-cover" width="72" height="96" priority="high" />
            } @else {
              <i class="pi pi-user" style="font-size: 1.25rem"></i>
            }
          </div>
          <div class="space-y-2">
            <input
              type="file"
              id="avatarInput"
              accept="image/jpeg,image/png"
              (change)="onAvatarChange($event)"
              class="hidden"
            />
            <div class="flex gap-2">
              <p-button
                (click)="triggerFileInput()"
                label="Change Avatar"
                severity="contrast"
                size="small"
                type="button"
                variant="outlined"
              ></p-button>
              <p-button
                (click)="onRemoveAvatar()"
                label="Remove"
                severity="danger"
                size="small"
                type="button"
                variant="outlined"
              ></p-button>
            </div>
            <p class="text-sm text-muted-foreground">JPG or PNG. Max size of 5MB</p>
          </div>
        </div>


          <div class="grid gap-4 md:grid-cols-2">
            <div class="flex flex-col space-y-3">
              <label class="text-sm font-medium leading-none" for="firstName">First Name</label>
              <input
                formControlName="firstName"
                id="firstName"
                pInputText
                pSize="small"
                placeholder="John"
                type="text"
              />
              @if (profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched) {
                <span class="text-xs text-red-500">First name is required (min 2 characters)</span>
              }
            </div>
            <div class="flex flex-col space-y-3">
              <label class="text-sm font-medium leading-none" for="lastName">Last Name</label>
              <input
                formControlName="lastName"
                id="lastName"
                pInputText
                pSize="small"
                placeholder="Doe"
                type="text"
              />
              @if (profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched) {
                <span class="text-xs text-red-500">Last name is required (min 2 characters)</span>
              }
            </div>
          </div>

          <div class="flex flex-col space-y-3">
            <label class="text-sm font-medium leading-none" for="email">Email</label>
            <input
              formControlName="email"
              id="email"
              pInputText
              pSize="small"
              placeholder="john@company.com"
              type="email"
            />
            @if (profileForm.get('email')?.invalid && profileForm.get('email')?.touched) {
              <span class="text-xs text-red-500">Valid email is required</span>
            }
          </div>
        </div>

        <div class="flex justify-end gap-4 pt-6">
          <p-button
            (click)="onCancel()"
            label="Cancel"
            severity="contrast"
            size="small"
            type="button"
            variant="outlined"
          />
          <p-button
            [disabled]="profileForm.invalid || !profileChanged()"
            [loading]="loading$ | async"
            label="Save Changes"
            severity="primary"
            size="small"
            type="submit"
          />
        </div>
      </form>
    </p-card>
  </div>
</div>
